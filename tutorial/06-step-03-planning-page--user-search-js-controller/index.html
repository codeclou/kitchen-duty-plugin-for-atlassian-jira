<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    
    
    <title>User Search JS Controller ~ Planning Page | Plugin Development Tutorial for Atlassian JIRAÂ® | Kitchen Duty Plugin by codeclou UG</title>
    <meta description="An interactive step-by-step tutorial on how to write Plugins for Atlassian Jira by codeclou UG">
    <meta name="robots" content="index, follow">


    
    <meta property="og:title" content="Kitchen Duty Plugin for Atlassian Jira by codeclou GmbH" />
    <meta property="og:image" content="https://codeclou.github.io/kitchen-duty-plugin-for-atlassian-jira/images/kitchen-duty-plugin--social.jpg" />
    <meta property="og:description" content="An interactive tutorial on how to write Plugins for Atlassian Jira by codeclou GmbH" />

    
    <link rel="canonical" href="https://codeclou.github.io/kitchen-duty-plugin-for-atlassian-jira/tutorial/06-step-03-planning-page--user-search-js-controller/" />

    <link rel="alternate" type="application/rss+xml" title="Kitchen Duty Plugin News" href="https://codeclou.github.io/kitchen-duty-plugin-for-atlassian-jira/rss_feed.xml" />



    <link href="/kitchen-duty-plugin-for-atlassian-jira/generated/bundlev2.css?v2018-09-02--12-50" rel="stylesheet">

    <link rel="icon" href="/kitchen-duty-plugin-for-atlassian-jira/images/favicon-32.png" type="image/png" sizes="32x32">
    <link rel="icon" href="/kitchen-duty-plugin-for-atlassian-jira/images/favicon-256.png" type="image/png" sizes="256x256">
    <link rel="icon" href="/kitchen-duty-plugin-for-atlassian-jira/images/favicon.svg" type="image/svg+xml">

    <script>var postLoadMethods = [];</script>
</head>
<body class="cs-tutorial-body">




















<textarea id="copy-to-clipboard-dummy"></textarea>
<div class="cs-page-header">
    <div class="row">
        <div class="col-md-5 cs-page-header-left">
            <a href="/kitchen-duty-plugin-for-atlassian-jira/" class="cs-page-logo">
                <span class="cs-page-logo-img d-none d-lg-inline"></span>
                <h1>Kitchen Duty Plugin</h1>
                <h2>Tutorial for Atlassian Jira Server</h2>
            </a>
            <a class="btn btn-primary cs-burger-button" id="toggleSidebarButton">
                <span class="cs-news-right" style="color:#fff;"><i class="fa fa-bars fa-lg" aria-hidden="true"></i></span>
            </a>
        </div>
        <div class="col-md-3 text-center d-none d-sm-block" style="padding-top:10px;">

            <!--
            <a class="btn btn-primary btn-borderless" href="/kitchen-duty-plugin-for-atlassian-jira/news/" target="_blank">
                <span class="cs-news-right">news</span>
            </a>
            -->
        </div>
    </div>
</div>

<!-- CONTENT -->


<div class="cs-content">
    <div class="cs-sidebar-wrapper">
        
<div id="toc">
    <ul>

        

        <li class="toc-h2 ">
            <a href="/kitchen-duty-plugin-for-atlassian-jira/tutorial/01-introduction/">
                <span>&nbsp;</span>
                Introduction
            </a>
        </li>
        <li class="toc-h2 ">
            <a href="/kitchen-duty-plugin-for-atlassian-jira/tutorial/02-step-00-getting-started/">
                <span class="cs-step-badge">0</span>
                Getting Started
            </a>
        </li>

        

        <li class="toc-h2-divider">Part I: Kitchen Duty Planning Page</li>

        <li class="toc-h2 ">
            <a href="/kitchen-duty-plugin-for-atlassian-jira/tutorial/03-story-workshop-for-planning-page/">
                <span>&nbsp;</span>
                Story Workshop for Planning Page
            </a>
        </li>
        <li class="toc-h2 ">
            <a href="/kitchen-duty-plugin-for-atlassian-jira/tutorial/04-step-01-planning-page--webwork-action-and-html-view/">
                <span class="cs-step-badge">1</span>
                Webwork Action and HTML View
            </a>
        </li>
        <li class="toc-h2 ">
            <a href="/kitchen-duty-plugin-for-atlassian-jira/tutorial/05-step-02-planning-page--user-search-rest-resource/">
                <span class="cs-step-badge">2</span>
                User Search REST Resource
            </a>
        </li>
        <li class="toc-h2 toc-active">
            <a href="/kitchen-duty-plugin-for-atlassian-jira/tutorial/06-step-03-planning-page--user-search-js-controller/">
                <span class="cs-step-badge">3</span>
                User Search JS Controller
            </a>
        </li>
        <li class="toc-h2 ">
            <a href="/kitchen-duty-plugin-for-atlassian-jira/tutorial/07-step-04-planning-page--kitchen-duty-planning-rest-resource/">
                <span class="cs-step-badge">4</span>
                Kitchen Duty Planning REST Resource
            </a>
        </li>
        <li class="toc-h2 ">
            <a href="/kitchen-duty-plugin-for-atlassian-jira/tutorial/08-step-05-planning-page--kitchen-duty-planning-js-controller/">
                <span class="cs-step-badge">5</span>
                Kitchen Duty Planning JS Controller
            </a>
        </li>


<!-- DISABLE SVG STATUS FOR NOW
        
        <li>
            
            
            
            
            
            
            
            
            <p>&nbsp;</p>
            <div class="cs-toc-infographic-wrapper">
                
<svg class="cs-interactive-graphic"
     id="navSvg11"
     data-json-settings="{
            &quot;markedAsDone&quot;: [ &quot;webwork-action&quot;, &quot;html-view&quot;, &quot;user-resource&quot;, &quot;user-search-resource-model&quot; ],
            &quot;markedAsTodo&quot;: [ &quot;user-js-controller&quot; ],
            &quot;markedAsGrayedOut&quot;: [ ],
            &quot;onClick&quot;: [ ]
            }"
     data-svg-to-load="kitchen-duty-planning-page--component-overview"
     viewBox="0 0 1043 654"
     preserveAspectRatio="xMaxYMax">
</svg>

            </div>
        </li>
        
-->

        

        <li class="toc-h2-divider">Part II: Kitchen Duty Overview Page</li>
        <li class="toc-h2 ">
            <a href="/kitchen-duty-plugin-for-atlassian-jira/tutorial/09-story-workshop-for-overview-page/">
                <span>&nbsp;</span>
                Story Workshop for Overview Page
            </a>
        </li>
        <li class="toc-h2 ">
            <a href="/kitchen-duty-plugin-for-atlassian-jira/tutorial/10-step-06-overview-page--implementation/">
                <span class="cs-step-badge">6</span>
                Kitchen Duty Overview Page
            </a>
        </li>


        


        <li class="toc-h2-divider">Misc</li>

        <li class="toc-h2 ">
            <a href="/kitchen-duty-plugin-for-atlassian-jira/news/">
                <span>&nbsp;</span>
                News
            </a>
        </li>

    </ul>







</div>


    </div>
    <div class="cs-content-wrapper">
        <div class="cs-content-wrapper-inner">
        



<div class="row">
    <div class="col-md-12">
        




<h2 class="cs-headline cs-headline--m cs-headline--anchor"
    data-scroll-to-headline="user-search-js-controller"
    data-scroll-to-headline-previous="">
    
    User Search JS Controller
</h2>




        
        
        


        <p>In the previous section we implemented the User Search REST Endpoint which we will now use
        from our JS Controller. You might want to check the <a href="/kitchen-duty-plugin-for-atlassian-jira/tutorial/03-story-workshop-for-planning-page/">Story Workshop</a> again to see what we
        want to build here.</p>


        <h3 class="cs-headline cs-headline--s">AUI and JIRA Version?</h3>


        <div class="row">
            <div class="col-md-6">
                <p>Ok so we want to use the <strong><a href="https://docs.atlassian.com/aui/latest/docs/auiselect2.html">Select2 Widget from the AUI Framework</a></strong>.
                    First you have to know that each version of JIRA has AUI prepackaged in a certain version.
                    Therefore we will use that and not pull in a second version of that (really, don't do that).</p>

                <p>So we do a <code>atlas-run</code> and wait for JIRA to startup. Now open the Browser Console
                    and type:</p>


                
<div class="cs-shell">
    <div class="cs-shell__inner">
        <a class="cs-shell__copy-clipboard cs--trigger-copy-clipboard" data-clipboard-text="AJS.version"
           data-toggle="tooltip" data-placement="left"
           data-title-orig="Copy file content to clipboard"
           title="Copy file content to clipboard"><i class="fa fa-files-o"></i></a>

        AJS.version<br>
        <pre class="cs-shell__output"><code class="hljs cs-shell__output-hljs"><span class="hljs-number">5.7</span>.<span class="hljs-number">31</span></code></pre>

    </div>
</div>



                <p>It will print the exact version used in the JIRA target version we code our plugin for.
                    At this point you really have to think about the range of versions you want to support with
                    your plugin. If you want to support older JIRA versions you need to know the lowest version of AUI
                    availabe and code with backwardscompatibility in mind. To make things simpler we assume that our
                    plugin will be compatible starting from JIRA 7.0 up to the latest JIRA version (currently 7.1.x).</p>

                <p>Alright now open the
                    <a href="https://docs.atlassian.com/aui/5.7.31/docs/applicationHeader.html" target="_blank">AUI documentation for 5.7.31</a>
                    and select AUI Select 2 documentation.
                    Ok no offense to the people writing the docs but it is a little thin and it took me some
                    time to come up with a hassle-free way to use the Select 2 the way I want it to behave.
                    You just read the doc and I will provide you some code you should like.</p>
            </div>
            <div class="offset-md-1 col-md-5">
                
    
    
        
    
    <div class="row">
        <div class="col-md-12">
            <p>
                <a href="/kitchen-duty-plugin-for-atlassian-jira/images/doc/step-03-ajs-version.png">
                    <img src="/kitchen-duty-plugin-for-atlassian-jira/images/doc/step-03-ajs-version.png" class="img-fluid" alt="Step 3 - Find out the AJS/AUI Version"
                         data-bilderrahmen="gallery-01"
                         data-bilderrahmen-title="Step 3 - Find out the AJS/AUI Version"
                    >
                </a>
            </p>
        </div>
    </div>

            </div>
        </div>


        <h3 class="cs-headline cs-headline--s">What about JS Frameworks, Template Engines and jQuery?</h3>

        <p>Alright that is it about our Widget. But how do we write our JavaScript code?
        Is there any template engine? Any watchers and/or frameworks? You have good point there.
        Let me tell you a short tale about JIRA and JavaScript...

        <p>Ok basically we already used <code>AJS.version</code> before, so you might have already wondered
        what that actually was. <strong>JIRA bundles a lightweight jQuery which is bound to <code>AJS</code></strong>
        there is no <code>$</code> or <code>jQuery</code> and even if there were you are advised to
        use <code>AJS</code> prefix. So here is a basic example:</p>


        
<div class="cs-shell">
    <div class="cs-shell__inner">
        <a class="cs-shell__copy-clipboard cs--trigger-copy-clipboard" data-clipboard-text="var theFooElement = AJS.$(&#39;#foo&#39;);"
           data-toggle="tooltip" data-placement="left"
           data-title-orig="Copy file content to clipboard"
           title="Copy file content to clipboard"><i class="fa fa-files-o"></i></a>

        var theFooElement = AJS.$(&#39;#foo&#39;);<br>
        <pre class="cs-shell__output"><code class="hljs cs-shell__output-hljs">undefined</code></pre>

    </div>
</div>


        <p>It will select the DOM element with id foo (when there is no such element it will return <code>undefined</code>).
            Ok just take that in for now, I know it is unfamiliar but we will get used to it.</p>

        <p>So what about template Engines? There is <a href="https://docs.atlassian.com/aui/latest/docs/soy.html" target="_blank">soy</a> which
            is basically the <a href="https://developers.google.com/closure/templates/"  target="_blank">Google Closure Template Framework</a>
            which can be used server-side and client-side. We will stick with velocity for server-side templates (you could switch to soy completely).
            And we will use soy-templates on the client-side.</p>

        <div class="cs-blockquote">
            <p>
                Small is beautiful - Avoid using big JavaScript frameworks that will register globals, bring in dependencies and tend to overwrite stuff that might break JIRA functionality.
                In most cases AUI already provides a way to solve your problem.
            </p>
        </div>


        <p>Alright let's resume what we are going to use:</p>

        <ul>
            <li>lightweight jQuery provided with <code>AJS</code> prefix</li>
            <li>AUI framework methods like <code>AJS.getI18nText</code></li>
            <li><a href="https://developer.atlassian.com/confdev/tutorials/writing-soy-templates-in-your-plugin" target="_blank">soy templates</a> (<a href="https://developers.google.com/closure/templates/"  target="_blank">Google Closure Template Framework</a>)</li>
            <li>html page with serverside velocity (which we will not use too much)</li>
        </ul>



        <h3 class="cs-headline cs-headline--s">Basic setup of JS Dependencies and Controller</h3>

        <p>Now we <strong>create our JS-Controller</strong> file in <code>/src/main/resources/js/kitchen-duty-plugin--planning-page-controller.js</code>.
        We put some simple dummy code inside which will trigger a <a href="https://docs.atlassian.com/aui/5.7.31/docs/flag.html">message flag</a> on pageload just to see if everything is working.</p>

        

<div class="cs-code-filename">
    <div class="cs-code-filename-inner">
        
        <span class="d-none d-lg-inline d-xl-inline">src/main/resources/js/</span><span class="d-none d-sm-inline d-lg-none d-xl-none"
                                                                data-toggle="tooltip"
                                                                data-placement="right"
                                                                title="src/main/resources/js/">.../</span>kitchen-duty-plugin--planning-page-controller.js
        
    </div>
    <div class="cs-code-buttons">
        
        <a href="https://github.com/codeclou/kitchen-duty-plugin-for-atlassian-jira/blob/master/step-03-kitchen-duty-plugin/src/main/resources/js/kitchen-duty-plugin--planning-page-controller.js" target="_blank"
        data-toggle="tooltip" data-placement="left" title="Open file on GitHub"
        class="cs-code-ghlink"><i class="fa fa-github"></i></a>
        
        <a class="cs-code-copylink cs--trigger-copy-clipboard"
        data-toggle="tooltip" data-placement="left"
        data-title-orig="Copy file content to clipboard"
        title="Copy file content to clipboard"
        data-clipboard-text="AJS.toInit(function(){
   require([&#39;aui/flag&#39;], function(flag) {
       var myFlag = flag({
           type: &#39;success&#39;,
           title: &#39;Kitchen Duty Plugin&#39;,
           body: &#39;JS Controller is working&#39;
       });
   });
});"><i class="fa fa-files-o"></i></a>
    </div>
</div>

<pre class="cs-code"><code class="hljs">AJS.toInit(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
   <span class="hljs-built_in">require</span>([<span class="hljs-string">'aui/flag'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">flag</span>) </span>{
       <span class="hljs-keyword">var</span> myFlag = flag({
           type: <span class="hljs-string">'success'</span>,
           title: <span class="hljs-string">'Kitchen Duty Plugin'</span>,
           body: <span class="hljs-string">'JS Controller is working'</span>
       });
   });
});</code></pre>


        <p>Our new JS Controller will not just work out of the box. We need to define a resource in <code>atlassian-plugin.xml</code>
            for our controller.</p>

        

<div class="cs-code-filename">
    <div class="cs-code-filename-inner">
        
        <span class="d-none d-lg-inline d-xl-inline">src/main/resources/</span><span class="d-none d-sm-inline d-lg-none d-xl-none"
                                                                data-toggle="tooltip"
                                                                data-placement="right"
                                                                title="src/main/resources/">.../</span>atlassian-plugin.xml
        
    </div>
    <div class="cs-code-buttons">
        
        <a href="https://github.com/codeclou/kitchen-duty-plugin-for-atlassian-jira/blob/master/step-03-kitchen-duty-plugin/src/main/resources/atlassian-plugin.xml" target="_blank"
        data-toggle="tooltip" data-placement="left" title="Open file on GitHub"
        class="cs-code-ghlink"><i class="fa fa-github"></i></a>
        
        <a class="cs-code-copylink cs--trigger-copy-clipboard"
        data-toggle="tooltip" data-placement="left"
        data-title-orig="Copy file content to clipboard"
        title="Copy file content to clipboard"
        data-clipboard-text="&lt;web-resource key=&quot;kitchen-duty-plugin-resources--planning-page&quot; name=&quot;kitchen-duty-plugin Web Resources for Planning Page&quot;&gt;
	&lt;dependency&gt;com.atlassian.auiplugin:ajs&lt;/dependency&gt;
	&lt;resource type=&quot;download&quot; name=&quot;kitchen-duty-plugin--planning-page-controller.js&quot; location=&quot;/js/kitchen-duty-plugin--planning-page-controller.js&quot;/&gt;
	&lt;context&gt;kitchen-duty-plugin&lt;/context&gt;
&lt;/web-resource&gt;"><i class="fa fa-files-o"></i></a>
    </div>
</div>

<pre class="cs-code"><code class="hljs"><span class="hljs-tag">&lt;<span class="hljs-title">web-resource</span> <span class="hljs-attribute">key</span>=<span class="hljs-value">"kitchen-duty-plugin-resources--planning-page"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"kitchen-duty-plugin Web Resources for Planning Page"</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>com.atlassian.auiplugin:ajs<span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-title">resource</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"download"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"kitchen-duty-plugin--planning-page-controller.js"</span> <span class="hljs-attribute">location</span>=<span class="hljs-value">"/js/kitchen-duty-plugin--planning-page-controller.js"</span>/&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-title">context</span>&gt;</span>kitchen-duty-plugin<span class="hljs-tag">&lt;/<span class="hljs-title">context</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">web-resource</span>&gt;</span></code></pre>


        <p>We have defined the resource now but JIRA does not know when to use (load) the resources we defined.
        <strong>We will use the PageBuilderService to tell JIRA when to load our resources</strong>.
            (You might want to try <code>#require</code> in your velocity templates instead, but PageBuilderService always worked best for me)</p>

        <p>We pull in some additional dependencies to be able to use PageBuilderService. Add these dependencies to your <code>pom.xml</code>.</p>


        

<div class="cs-code-filename">
    <div class="cs-code-filename-inner">
        
        pom.xml
        
    </div>
    <div class="cs-code-buttons">
        
        <a href="https://github.com/codeclou/kitchen-duty-plugin-for-atlassian-jira/blob/master/step-03-kitchen-duty-plugin/pom.xml" target="_blank"
        data-toggle="tooltip" data-placement="left" title="Open file on GitHub"
        class="cs-code-ghlink"><i class="fa fa-github"></i></a>
        
        <a class="cs-code-copylink cs--trigger-copy-clipboard"
        data-toggle="tooltip" data-placement="left"
        data-title-orig="Copy file content to clipboard"
        title="Copy file content to clipboard"
        data-clipboard-text="&lt;dependency&gt;
	&lt;groupId&gt;com.atlassian.templaterenderer&lt;/groupId&gt;
	&lt;artifactId&gt;atlassian-template-renderer-api&lt;/artifactId&gt;
	&lt;version&gt;1.5.7&lt;/version&gt;
	&lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
	&lt;groupId&gt;com.atlassian.plugins&lt;/groupId&gt;
	&lt;artifactId&gt;atlassian-plugins-webresource&lt;/artifactId&gt;
	&lt;version&gt;3.3.3&lt;/version&gt;
	&lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;"><i class="fa fa-files-o"></i></a>
    </div>
</div>

<pre class="cs-code"><code class="hljs"><span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>com.atlassian.templaterenderer<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>atlassian-template-renderer-api<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>1.5.7<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-title">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-title">scope</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>com.atlassian.plugins<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>atlassian-plugins-webresource<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-title">version</span>&gt;</span>3.3.3<span class="hljs-tag">&lt;/<span class="hljs-title">version</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-title">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-title">scope</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span></code></pre>


        <p>We already learned that we need to do a <code>@ComponentImport</code> somewhere in our application to pull dependencies from other OSGi Bundles.
        That is why we simply do that in our <code>MyPluginComponentImpl.java</code> file which we will (mis)use for that purpose from now on.</p>

        

<div class="cs-code-filename">
    <div class="cs-code-filename-inner">
        
        <span class="d-none d-lg-inline d-xl-inline">src/main/java/com/codeclou/kitchen/duty/impl/</span><span class="d-none d-sm-inline d-lg-none d-xl-none"
                                                                data-toggle="tooltip"
                                                                data-placement="right"
                                                                title="src/main/java/com/codeclou/kitchen/duty/impl/">.../</span>MyPluginComponentImpl.java
        
    </div>
    <div class="cs-code-buttons">
        
        <a href="https://github.com/codeclou/kitchen-duty-plugin-for-atlassian-jira/blob/master/step-03-kitchen-duty-plugin/src/main/java/com/codeclou/kitchen/duty/impl/MyPluginComponentImpl.java" target="_blank"
        data-toggle="tooltip" data-placement="left" title="Open file on GitHub"
        class="cs-code-ghlink"><i class="fa fa-github"></i></a>
        
        <a class="cs-code-copylink cs--trigger-copy-clipboard"
        data-toggle="tooltip" data-placement="left"
        data-title-orig="Copy file content to clipboard"
        title="Copy file content to clipboard"
        data-clipboard-text="import com.atlassian.webresource.api.assembler.PageBuilderService;

...

@ComponentImport
private PageBuilderService pageBuilderService;"><i class="fa fa-files-o"></i></a>
    </div>
</div>

<pre class="cs-code"><code class="hljs"><span class="hljs-keyword">import</span> com.atlassian.webresource.api.assembler.PageBuilderService;

...

<span class="hljs-annotation">@ComponentImport</span>
<span class="hljs-keyword">private</span> PageBuilderService pageBuilderService;</code></pre>


        <p>Now that the PageBuilderService is usable we need to tell our Webwork Action to load our resources.</p>

        <div class="row">
            <div class="col-md-8">
                

<div class="cs-code-filename">
    <div class="cs-code-filename-inner">
        
        <span class="d-none d-lg-inline d-xl-inline">src/main/java/com/codeclou/kitchen/duty/webwork/</span><span class="d-none d-sm-inline d-lg-none d-xl-none"
                                                                data-toggle="tooltip"
                                                                data-placement="right"
                                                                title="src/main/java/com/codeclou/kitchen/duty/webwork/">.../</span>KitchenDutyPlanningWebworkAction.java
        
    </div>
    <div class="cs-code-buttons">
        
        <a href="https://github.com/codeclou/kitchen-duty-plugin-for-atlassian-jira/blob/master/step-03-kitchen-duty-plugin/src/main/java/com/codeclou/kitchen/duty/webwork/KitchenDutyPlanningWebworkAction.java" target="_blank"
        data-toggle="tooltip" data-placement="left" title="Open file on GitHub"
        class="cs-code-ghlink"><i class="fa fa-github"></i></a>
        
        <a class="cs-code-copylink cs--trigger-copy-clipboard"
        data-toggle="tooltip" data-placement="left"
        data-title-orig="Copy file content to clipboard"
        title="Copy file content to clipboard"
        data-clipboard-text="package io.codeclou.kitchen.duty.webwork;

import com.atlassian.webresource.api.assembler.PageBuilderService;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import com.atlassian.jira.web.action.JiraWebActionSupport;

import javax.inject.Inject;
import javax.inject.Named;

@Named 
public class KitchenDutyPlanningWebworkAction extends JiraWebActionSupport
{
    private static final Logger log = LoggerFactory.getLogger(KitchenDutyPlanningWebworkAction.class);

    @Inject 
    private PageBuilderService pageBuilderService;

    @Override
    public String execute() throws Exception {
        pageBuilderService.assembler().resources().requireWebResource(
           &quot;io.codeclou.kitchen-duty-plugin:kitchen-duty-plugin-resources&quot; 
        ).requireWebResource(
           &quot;io.codeclou.kitchen-duty-plugin:kitchen-duty-plugin-resources--planning-page&quot;
        );

        return &quot;kitchen-duty-planning-success&quot;;
    }

    public void setPageBuilderService(PageBuilderService pageBuilderService) { 
        this.pageBuilderService = pageBuilderService;
    }
}"><i class="fa fa-files-o"></i></a>
    </div>
</div>

<pre class="cs-code"><code class="hljs"><span class="hljs-keyword">package</span> io.codeclou.kitchen.duty.webwork;

<span class="hljs-keyword">import</span> com.atlassian.webresource.api.assembler.PageBuilderService;
<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;
<span class="hljs-keyword">import</span> com.atlassian.jira.web.action.JiraWebActionSupport;

<span class="hljs-keyword">import</span> javax.inject.Inject;
<span class="hljs-keyword">import</span> javax.inject.Named;

<span class="hljs-annotation">@Named</span> <span class="cs-source-point" data-cs-source-point-id="h768go8gbo8gv8gbu909" data-cs-source-point-number="1"></span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KitchenDutyPlanningWebworkAction</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JiraWebActionSupport</span>
</span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger log = LoggerFactory.getLogger(KitchenDutyPlanningWebworkAction.class);

    <span class="hljs-annotation">@Inject</span> <span class="cs-source-point" data-cs-source-point-id="h768go8gbo8gv8gbu909" data-cs-source-point-number="2"></span>
    <span class="hljs-keyword">private</span> PageBuilderService pageBuilderService;

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">execute</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{
        pageBuilderService.assembler().resources().requireWebResource(
           <span class="hljs-string">"io.codeclou.kitchen-duty-plugin:kitchen-duty-plugin-resources"</span> <span class="cs-source-point" data-cs-source-point-id="h768go8gbo8gv8gbu909" data-cs-source-point-number="3"></span>
        ).requireWebResource(
           <span class="hljs-string">"io.codeclou.kitchen-duty-plugin:kitchen-duty-plugin-resources--planning-page"</span>
        );

        <span class="hljs-keyword">return</span> <span class="hljs-string">"kitchen-duty-planning-success"</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPageBuilderService</span><span class="hljs-params">(PageBuilderService pageBuilderService)</span> </span>{ <span class="cs-source-point" data-cs-source-point-id="h768go8gbo8gv8gbu909" data-cs-source-point-number="4"></span>
        <span class="hljs-keyword">this</span>.pageBuilderService = pageBuilderService;
    }
}</code></pre>

            </div>
            <div class="col-md-4 cs-sticky-in-parent">
                <div class="list-group cs-source-point-list" data-source-target="h768go8gbo8gv8gbu909">
                    <div class="list-group-item cs-source-point-list__item">
                        Define our <code>KitchenDutyPlanningWebworkAction</code> as <code>@Named</code>-component.
                    </div>
                    <div class="list-group-item cs-source-point-list__item">
                        Use <code>@Inject</code> to wire the <code>PageBuilderService</code>.
                    </div>
                    <div class="list-group-item cs-source-point-list__item">
                        We tell the PageBuilderService via <code>requireWebResource()</code>
                        to load our shared resource bundle and our planning-page bundle containing the controller.
                        The pattern for require is <code>"pluginKey:resourceKey"</code>.
                    </div>
                    <div class="list-group-item cs-source-point-list__item">
                        And of course a setter for the setter injection of PageBuilderService.
                    </div>
                </div>
            </div>
        </div>


        <p>After starting up JIRA via <code>atlas-run</code> (you should restart atlas-run because we added something to pom.xml) you
            <strong>should see a green success message popping up on the top right </strong> when
        surfing to planning page: <a class="cs-do-wrap" href="http://localhost:2990/jira/secure/KitchenDutyPlanningWebworkAction.jspa">http://localhost:2990/jira/secure/KitchenDutyPlanningWebworkAction.jspa</a></p>

        
    
    
    <div class="row">
        <div class="offset-md-1 col-md-10">
            <p>
                <a href="/kitchen-duty-plugin-for-atlassian-jira/images/doc/step-03-js-controller-working.gif">
                    <img src="/kitchen-duty-plugin-for-atlassian-jira/images/doc/step-03-js-controller-working.gif" class="img-fluid" alt="Step 3 - Test of JS Controller for Planning Page"
                         data-bilderrahmen="gallery-01"
                         data-bilderrahmen-title="Step 3 - Test of JS Controller for Planning Page"
                    >
                </a>
            </p>
        </div>
    </div>



        <div class="cs-v-spacer cs-v-spacer--big"></div>

        <h3 class="cs-headline cs-headline--s">Setting up Select2 Widget to find Users</h3>

        <p>Before we start you might (not necessary) want to read in depth about <a href="https://docs.atlassian.com/aui/latest/docs/layout.html" target="_blank">AUI Layout</a>,
            <a href="https://docs.atlassian.com/aui/latest/docs/forms.html" target="_blank">AUI Forms</a> and <a href="https://developer.atlassian.com/confdev/tutorials/writing-soy-templates-in-your-plugin" target="_blank">Soy</a>.</p>

        <p>What is soy? It is a templating framework with templates we can use server-side and client-side. Cool! But we will need a transformer to transform the
        soy templates into JavaScript to be able to use them in our JS-Controller.</p>

        <p>Here is a short summary of what we will be doing now:</p>
        <ul>
            <li>Create a soy template for the user search.</li>
            <li>define a transformer to be able to use soy template in JS Controller.</li>
            <li>write some JS code to use <a href="https://docs.atlassian.com/aui/latest/docs/auiselect2.html" target="_blank">AUI Select2 widget</a> with our User Search REST Resource (see previous chapter).</li>
        </ul>

        <p>Create the soy template file in <code>src/main/resources/templates-soy/kitchen-duty-planning.soy</code> and paste the following code there.</p>
        <p>This file will later contain more than one template for each use case. But we will have one file per page.</p>

        <div class="row">
            <div class="col-md-8">
                

<div class="cs-code-filename">
    <div class="cs-code-filename-inner">
        
        <span class="d-none d-lg-inline d-xl-inline">src/main/resources/templates-soy/</span><span class="d-none d-sm-inline d-lg-none d-xl-none"
                                                                data-toggle="tooltip"
                                                                data-placement="right"
                                                                title="src/main/resources/templates-soy/">.../</span>kitchen-duty-planning.soy
        
    </div>
    <div class="cs-code-buttons">
        
        <a href="https://github.com/codeclou/kitchen-duty-plugin-for-atlassian-jira/blob/master/step-03-kitchen-duty-plugin/src/main/resources/templates-soy/kitchen-duty-planning.soy" target="_blank"
        data-toggle="tooltip" data-placement="left" title="Open file on GitHub"
        class="cs-code-ghlink"><i class="fa fa-github"></i></a>
        
        <a class="cs-code-copylink cs--trigger-copy-clipboard"
        data-toggle="tooltip" data-placement="left"
        data-title-orig="Copy file content to clipboard"
        title="Copy file content to clipboard"
        data-clipboard-text="{namespace JIRA.Templates.KDP} 
/**
 * Kitchen Duty Planning Page - User Search Template
 */
{template .userSearch} 
&lt;form class=&quot;aui&quot; id=&quot;kdp-user-select-form&quot;&gt; 

    &lt;div class=&quot;field-group&quot;&gt;
        &lt;label for=&quot;kdp-user-select&quot;&gt;Users&lt;/label&gt;
        &lt;div id=&quot;kdp-user-select&quot;  
                 name=&quot;kdp-user-select&quot;
                 class=&quot;kdp-aui-select&quot;
                 multiple=&quot;&quot;
                 placeholder=&quot;start typing a username ...&quot;&gt;
        &lt;/div&gt;
        &lt;div class=&quot;description&quot;&gt;The users that should have kitchen duty.&lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;buttons-container&quot;&gt;
        &lt;div class=&quot;buttons&quot;&gt;
            &lt;input class=&quot;button submit&quot; type=&quot;submit&quot; 
                   id=&quot;kdp-user-select-save-button&quot;
                   value=&quot;show&quot;/&gt;
        &lt;/div&gt;
    &lt;/div&gt;

&lt;/form&gt;
{/template}"><i class="fa fa-files-o"></i></a>
    </div>
</div>

<pre class="cs-code"><code class="hljs"><span class="hljs-soyTag">{<span class="hljs-title"><span class="hljs-tag">namespace</span> JIRA.Templates.KDP</span>}</span> <span class="hljs-soyTag"><span class="cs-source-point" data-cs-source-point-id="dsfhuzk65fdsb6" data-cs-source-point-number="1"></span>
<span class="hljs-comment">/**
 * Kitchen Duty Planning Page - User Search Template
 */</span>
<span class="hljs-soyTag">{<span class="hljs-title"><span class="hljs-tag">template</span> .userSearch</span>}</span> <span class="hljs-soyTag"><span class="cs-source-point" data-cs-source-point-id="dsfhuzk65fdsb6" data-cs-source-point-number="2"></span>
&lt;form class=<span class="hljs-string">"aui"</span> id=<span class="hljs-string">"kdp-user-select-form"</span>&gt; <span class="hljs-soyTag"><span class="cs-source-point" data-cs-source-point-id="dsfhuzk65fdsb6" data-cs-source-point-number="3"></span>

    &lt;div class=<span class="hljs-string">"field-group"</span>&gt;
        &lt;label for=<span class="hljs-string">"kdp-user-select"</span>&gt;Users&lt;/label&gt;
        &lt;div id=<span class="hljs-string">"kdp-user-select"</span>  <span class="hljs-soyTag"><span class="cs-source-point" data-cs-source-point-id="dsfhuzk65fdsb6" data-cs-source-point-number="4"></span>
                 name=<span class="hljs-string">"kdp-user-select"</span>
                 class=<span class="hljs-string">"kdp-aui-select"</span>
                 multiple=<span class="hljs-string">""</span>
                 placeholder=<span class="hljs-string">"start typing a username ..."</span>&gt;
        &lt;/div&gt;
        &lt;div class=<span class="hljs-string">"description"</span>&gt;The users that should have kitchen duty.&lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=<span class="hljs-string">"buttons-container"</span>&gt;
        &lt;div class=<span class="hljs-string">"buttons"</span>&gt;
            &lt;input class=<span class="hljs-string">"button submit"</span> type=<span class="hljs-string">"submit"</span> <span class="hljs-soyTag"><span class="cs-source-point" data-cs-source-point-id="dsfhuzk65fdsb6" data-cs-source-point-number="5"></span>
                   id=<span class="hljs-string">"kdp-user-select-save-button"</span>
                   value=<span class="hljs-string">"show"</span>/&gt;
        &lt;/div&gt;
    &lt;/div&gt;

&lt;/form&gt;
<span class="hljs-soyTag">{/<span class="hljs-tag">template</span>}</span></code></pre>

            </div>
            <div class="col-md-4 cs-sticky-in-parent">
                <div class="list-group cs-source-point-list" data-source-target="dsfhuzk65fdsb6">
                    <div class="list-group-item cs-source-point-list__item">
                        We define a namespace called <code>JIRA.Templates.KDP</code> for our templates.
                        Later we will access all out templates with <code>namespace.templateName</code>.
                    </div>
                    <div class="list-group-item cs-source-point-list__item">
                        Our first actual template will be called <code>.userSearch</code> and contains HTML code we will later
                        use from our JS Controller.
                    </div>
                    <div class="list-group-item cs-source-point-list__item">
                        The input-fields and AUI widgets will only render correctly if we surround them with a form that has a class called <code>aui</code>.
                        We define an id on the form to be able to access it via jQuery later.
                    </div>
                    <div class="list-group-item cs-source-point-list__item">
                        This is the container for the AUI Select 2 widget. We use a <code>div</code> with id <code>kdp-user-select</code>.
                        Don't forget <code>multiple</code> to tell the widget on init that this field will accept multiple values.
                    </div>
                    <div class="list-group-item cs-source-point-list__item">
                        The last thing we need is a button to submit the form.
                        We also give the button a unique id to use it via jQuery later.
                    </div>
                </div>
            </div>
        </div>


        <p>Change velocity template so that we have one div container with an id we can use to dynamically insert our content which is rendered by JS-Controller.</p>
        <div class="row">
            <div class="col-md-8">
                

<div class="cs-code-filename">
    <div class="cs-code-filename-inner">
        
        <span class="d-none d-lg-inline d-xl-inline">src/main/resources/templates/kitchen-duty-planning-webwork-module/</span><span class="d-none d-sm-inline d-lg-none d-xl-none"
                                                                data-toggle="tooltip"
                                                                data-placement="right"
                                                                title="src/main/resources/templates/kitchen-duty-planning-webwork-module/">.../</span>kitchen-duty-planning-success.vm
        
    </div>
    <div class="cs-code-buttons">
        
        <a href="https://github.com/codeclou/kitchen-duty-plugin-for-atlassian-jira/blob/master/step-03-kitchen-duty-plugin/src/main/resources/templates/kitchen-duty-planning-webwork-module/kitchen-duty-planning-success.vm" target="_blank"
        data-toggle="tooltip" data-placement="left" title="Open file on GitHub"
        class="cs-code-ghlink"><i class="fa fa-github"></i></a>
        
        <a class="cs-code-copylink cs--trigger-copy-clipboard"
        data-toggle="tooltip" data-placement="left"
        data-title-orig="Copy file content to clipboard"
        title="Copy file content to clipboard"
        data-clipboard-text="&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;$i18n.getText(&quot;kitchen-duty-plugin.admin.planning.page.title&quot;)&lt;/title&gt;
    &lt;meta name=&quot;decorator&quot; content=&quot;atl.admin&quot;&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;$i18n.getText(&quot;kitchen-duty-plugin.admin.planning.page.headline&quot;)&lt;/h1&gt;

&lt;div id=&quot;kdp-planning-page-container&quot;&gt;&lt;/div&gt; 

&lt;/body&gt;
&lt;/html&gt;"><i class="fa fa-files-o"></i></a>
    </div>
</div>

<pre class="cs-code"><code class="hljs"><span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>$i18n.getText("kitchen-duty-plugin.admin.planning.page.title")<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"decorator"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"atl.admin"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span>$i18n.getText("kitchen-duty-plugin.admin.planning.page.headline")<span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"kdp-planning-page-container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span> <span class="cs-source-point" data-cs-source-point-id="h76sdfsgdfgodjfnsdfnsdfdsdsf909" data-cs-source-point-number="1"></span>

<span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span></code></pre>

            </div>
            <div class="col-md-4 cs-sticky-in-parent">
                <div class="list-group cs-source-point-list" data-source-target="h76sdfsgdfgodjfnsdfnsdfdsdsf909">
                    <div class="list-group-item cs-source-point-list__item">
                        The only thing we change in our Velocity template is to place on div container which we will use
                        to append the rendered template(s) to.
                    </div>
                </div>
            </div>
        </div>

        <p>Change the JS-Controller to render the soy template, initialize the AUI Select 2 widget to work with our User Search REST Resource.</p>

        <div class="row">
            <div class="col-md-7">
                

<div class="cs-code-filename">
    <div class="cs-code-filename-inner">
        
        <span class="d-none d-lg-inline d-xl-inline">src/main/resources/js/</span><span class="d-none d-sm-inline d-lg-none d-xl-none"
                                                                data-toggle="tooltip"
                                                                data-placement="right"
                                                                title="src/main/resources/js/">.../</span>kitchen-duty-plugin--planning-page-controller.js
        
    </div>
    <div class="cs-code-buttons">
        
        <a href="https://github.com/codeclou/kitchen-duty-plugin-for-atlassian-jira/blob/master/step-03-kitchen-duty-plugin/src/main/resources/js/kitchen-duty-plugin--planning-page-controller.js" target="_blank"
        data-toggle="tooltip" data-placement="left" title="Open file on GitHub"
        class="cs-code-ghlink"><i class="fa fa-github"></i></a>
        
        <a class="cs-code-copylink cs--trigger-copy-clipboard"
        data-toggle="tooltip" data-placement="left"
        data-title-orig="Copy file content to clipboard"
        title="Copy file content to clipboard"
        data-clipboard-text="var showSuccessFlag = function(message) { 
    require([&#39;aui/flag&#39;], function(flag) {
        var myFlag = flag({
            type: &#39;success&#39;,
            title: &#39;Kitchen Duty Plugin&#39;,
            close: &#39;auto&#39;,
            body: message
        });
    });
};

var initUserSearch = function(restUrl) { 
    var templateUserSearch = JIRA.Templates.KDP.userSearch(); 

    var auiUserSelectOptions = {
        ajax: {
            url: function () {
                return restUrl + &#39;/user/search&#39;; 
            },
            dataType: &#39;json&#39;,
            delay: 250,
            data: function (searchTerm) {
                return {
                    query: searchTerm
                };
            },
            results: function (data) {
                return {
                    results: data
                };
            },
            cache: true
        },
        minimumInputLength: 1,
        tags: &#39;true&#39; 
    };

    /* INIT TEMPLATES AND WIDGETS */

    AJS.$(&#39;#kdp-planning-page-container&#39;).append(templateUserSearch); 
    AJS.$(&#39;#kdp-user-select&#39;).auiSelect2(auiUserSelectOptions); 
    AJS.$(&#39;#kdp-user-select-form&#39;).submit(function (e) { 
        e.preventDefault();
        AJS.$(AJS.$(&#39;#kdp-user-select&#39;).select2(&#39;data&#39;)).each(function () { 
            showSuccessFlag(this.id);
        });
    });
};

AJS.toInit(function(){ 
    AJS.log(&#39;KDP: Planning Page Controller initializing ...&#39;);
    var baseUrl = AJS.params.baseURL; 
    var restUrl = baseUrl + &#39;/rest/kitchenduty/1.0&#39;;

    initUserSearch(restUrl); 
});"><i class="fa fa-files-o"></i></a>
    </div>
</div>

<pre class="cs-code"><code class="hljs"><span class="hljs-keyword">var</span> showSuccessFlag = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">message</span>) </span>{ <span class="cs-source-point" data-cs-source-point-id="iusndf98sidjcn" data-cs-source-point-number="1"></span>
    <span class="hljs-built_in">require</span>([<span class="hljs-string">'aui/flag'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">flag</span>) </span>{
        <span class="hljs-keyword">var</span> myFlag = flag({
            type: <span class="hljs-string">'success'</span>,
            title: <span class="hljs-string">'Kitchen Duty Plugin'</span>,
            close: <span class="hljs-string">'auto'</span>,
            body: message
        });
    });
};

<span class="hljs-keyword">var</span> initUserSearch = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">restUrl</span>) </span>{ <span class="cs-source-point" data-cs-source-point-id="iusndf98sidjcn" data-cs-source-point-number="2"></span>
    <span class="hljs-keyword">var</span> templateUserSearch = JIRA.Templates.KDP.userSearch(); <span class="cs-source-point" data-cs-source-point-id="iusndf98sidjcn" data-cs-source-point-number="3"></span>

    <span class="hljs-keyword">var</span> auiUserSelectOptions = {
        ajax: {
            url: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> restUrl + <span class="hljs-string">'/user/search'</span>; <span class="cs-source-point" data-cs-source-point-id="iusndf98sidjcn" data-cs-source-point-number="4"></span>
            },
            dataType: <span class="hljs-string">'json'</span>,
            delay: <span class="hljs-number">250</span>,
            data: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">searchTerm</span>) </span>{
                <span class="hljs-keyword">return</span> {
                    query: searchTerm
                };
            },
            results: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>{
                <span class="hljs-keyword">return</span> {
                    results: data
                };
            },
            cache: <span class="hljs-literal">true</span>
        },
        minimumInputLength: <span class="hljs-number">1</span>,
        tags: <span class="hljs-string">'true'</span> <span class="cs-source-point" data-cs-source-point-id="iusndf98sidjcn" data-cs-source-point-number="5"></span>
    };

    <span class="hljs-comment">/* INIT TEMPLATES AND WIDGETS */</span>

    AJS.$(<span class="hljs-string">'#kdp-planning-page-container'</span>).append(templateUserSearch); <span class="cs-source-point" data-cs-source-point-id="iusndf98sidjcn" data-cs-source-point-number="6"></span>
    AJS.$(<span class="hljs-string">'#kdp-user-select'</span>).auiSelect2(auiUserSelectOptions); <span class="cs-source-point" data-cs-source-point-id="iusndf98sidjcn" data-cs-source-point-number="7"></span>
    AJS.$(<span class="hljs-string">'#kdp-user-select-form'</span>).submit(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{ <span class="cs-source-point" data-cs-source-point-id="iusndf98sidjcn" data-cs-source-point-number="8"></span>
        e.preventDefault();
        AJS.$(AJS.$(<span class="hljs-string">'#kdp-user-select'</span>).select2(<span class="hljs-string">'data'</span>)).each(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="cs-source-point" data-cs-source-point-id="iusndf98sidjcn" data-cs-source-point-number="9"></span>
            showSuccessFlag(<span class="hljs-keyword">this</span>.id);
        });
    });
};

AJS.toInit(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{ <span class="cs-source-point" data-cs-source-point-id="iusndf98sidjcn" data-cs-source-point-number="10"></span>
    AJS.log(<span class="hljs-string">'KDP: Planning Page Controller initializing ...'</span>);
    <span class="hljs-keyword">var</span> baseUrl = AJS.params.baseURL; <span class="cs-source-point" data-cs-source-point-id="iusndf98sidjcn" data-cs-source-point-number="11"></span>
    <span class="hljs-keyword">var</span> restUrl = baseUrl + <span class="hljs-string">'/rest/kitchenduty/1.0'</span>;

    initUserSearch(restUrl); <span class="cs-source-point" data-cs-source-point-id="iusndf98sidjcn" data-cs-source-point-number="12"></span>
});</code></pre>

            </div>
            <div class="col-md-5 cs-sticky-in-parent">
                <div class="list-group cs-source-point-list" data-source-target="iusndf98sidjcn">
                    <div class="list-group-item cs-source-point-list__item">
                        We put the message flag into a function so that we can easily create success flags everywhere we want.
                    </div>
                    <div class="list-group-item cs-source-point-list__item">
                        We define an init function for our user search code. Inside there we will initialize everything we need for AUI Select 2.
                    </div>
                    <div class="list-group-item cs-source-point-list__item">
                        The first thing we do is get our <code>userSearch</code> soy template and have it ready to use.
                    </div>
                    <div class="list-group-item cs-source-point-list__item">
                        The <code>auiUserSelectOptions</code> are the options of AUI Select 2 which you can read in the docs.
                        We define the URL here where the AUI Select 2 field should query for usernames.
                        The rest of the options is necessary and should be self explanatory.
                    </div>
                    <div class="list-group-item cs-source-point-list__item">
                        This option tells the AUI Select 2 that we want to have tags which should be removable.
                    </div>
                    <div class="list-group-item cs-source-point-list__item">
                        Now we append our rendered userSearch soy template to the DOM into our special div-container we defined earlier.
                    </div>
                    <div class="list-group-item cs-source-point-list__item">
                        Right after that we initialize the AUI Select 2 field for userSearch with the previously defined options.
                    </div>
                    <div class="list-group-item cs-source-point-list__item">
                        Now we hook into the submit button of the form and prevent the default-form-submit.
                        Otherwise the form would trigger a POST/GET request which we don't want.
                    </div>
                    <div class="list-group-item cs-source-point-list__item">
                        Later we will hook the code to save the selection in here, but that will happen in future chapters.
                        For now we are fine with getting each selected username displayed as a success flag.
                        <code>select2('data')</code> returns an array with all selected elements.
                    </div>
                    <div class="list-group-item cs-source-point-list__item">
                        The <code>AJS.toInit</code> function is a little helper that executes its callback when the AUI Framework has loaded.
                        We put all calls to our init functions there.
                    </div>
                    <div class="list-group-item cs-source-point-list__item">
                        We get the baseUrl from the AUI Framework. If you call the <code>AJS.params.baseURL</code> to early outside the <code>AJS.init</code> helper
                        you will get undefined errors. Depending on the baseUrl we build our base <code>restUrl</code> which all Endpoints have in common.
                    </div>
                    <div class="list-group-item cs-source-point-list__item">
                        Finally we call the initUserSearch function and pass the restUrl.
                    </div>
                </div>
            </div>
        </div>

        <p>&nbsp;</p>

        <p>Now we need to teach JIRA that we want to use soy in our client-side code and define a transformer and the soy template to load. Also we need to define AUI dependencies to be loaded.</p>
        <div class="row">
            <div class="col-md-8">
                

<div class="cs-code-filename">
    <div class="cs-code-filename-inner">
        
        <span class="d-none d-lg-inline d-xl-inline">src/main/resources/</span><span class="d-none d-sm-inline d-lg-none d-xl-none"
                                                                data-toggle="tooltip"
                                                                data-placement="right"
                                                                title="src/main/resources/">.../</span>atlassian-plugin.xml
        
    </div>
    <div class="cs-code-buttons">
        
        <a href="https://github.com/codeclou/kitchen-duty-plugin-for-atlassian-jira/blob/master/step-03-kitchen-duty-plugin/src/main/resources/atlassian-plugin.xml" target="_blank"
        data-toggle="tooltip" data-placement="left" title="Open file on GitHub"
        class="cs-code-ghlink"><i class="fa fa-github"></i></a>
        
        <a class="cs-code-copylink cs--trigger-copy-clipboard"
        data-toggle="tooltip" data-placement="left"
        data-title-orig="Copy file content to clipboard"
        title="Copy file content to clipboard"
        data-clipboard-text="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;

&lt;atlassian-plugin key=&quot;${atlassian.plugin.key}&quot; name=&quot;${project.name}&quot; plugins-version=&quot;2&quot;&gt;
...
  &lt;web-resource key=&quot;kitchen-duty-plugin-resources--planning-page&quot; name=&quot;kitchen-duty-plugin Web Resources for Planning Page&quot;&gt;
    &lt;dependency&gt;com.atlassian.auiplugin:ajs&lt;/dependency&gt;
    &lt;dependency&gt;com.atlassian.auiplugin:aui-select2&lt;/dependency&gt; 
    &lt;dependency&gt;com.atlassian.auiplugin:aui-experimental-soy-templates&lt;/dependency&gt; 
    &lt;transformation extension=&quot;soy&quot;&gt; 
      &lt;transformer key=&quot;soyTransformer&quot;&gt;
        &lt;functions&gt;com.atlassian.confluence.plugins.soy:soy-core-functions&lt;/functions&gt;
      &lt;/transformer&gt;
    &lt;/transformation&gt;
    &lt;resource type=&quot;download&quot; name=&quot;kitchen-duty-planning-soy.js&quot; 
              location=&quot;templates-soy/kitchen-duty-planning.soy&quot;/&gt;
    &lt;resource type=&quot;download&quot; name=&quot;kitchen-duty-plugin--planning-page-controller.js&quot;
              location=&quot;/js/kitchen-duty-plugin--planning-page-controller.js&quot;/&gt;
    &lt;context&gt;kitchen-duty-plugin&lt;/context&gt;
  &lt;/web-resource&gt;
...
&lt;/atlassian-plugin&gt;"><i class="fa fa-files-o"></i></a>
    </div>
</div>

<pre class="cs-code"><code class="hljs"><span class="hljs-pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">atlassian-plugin</span> <span class="hljs-attribute">key</span>=<span class="hljs-value">"${atlassian.plugin.key}"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"${project.name}"</span> <span class="hljs-attribute">plugins-version</span>=<span class="hljs-value">"2"</span>&gt;</span>
...
  <span class="hljs-tag">&lt;<span class="hljs-title">web-resource</span> <span class="hljs-attribute">key</span>=<span class="hljs-value">"kitchen-duty-plugin-resources--planning-page"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"kitchen-duty-plugin Web Resources for Planning Page"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>com.atlassian.auiplugin:ajs<span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>com.atlassian.auiplugin:aui-select2<span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span> <span class="cs-source-point" data-cs-source-point-id="difjn9sufpoj" data-cs-source-point-number="1"></span>
    <span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>com.atlassian.auiplugin:aui-experimental-soy-templates<span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span> <span class="cs-source-point" data-cs-source-point-id="difjn9sufpoj" data-cs-source-point-number="2"></span>
    <span class="hljs-tag">&lt;<span class="hljs-title">transformation</span> <span class="hljs-attribute">extension</span>=<span class="hljs-value">"soy"</span>&gt;</span> <span class="cs-source-point" data-cs-source-point-id="difjn9sufpoj" data-cs-source-point-number="3"></span>
      <span class="hljs-tag">&lt;<span class="hljs-title">transformer</span> <span class="hljs-attribute">key</span>=<span class="hljs-value">"soyTransformer"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">functions</span>&gt;</span>com.atlassian.confluence.plugins.soy:soy-core-functions<span class="hljs-tag">&lt;/<span class="hljs-title">functions</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-title">transformer</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">transformation</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">resource</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"download"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"kitchen-duty-planning-soy.js"</span> <span class="cs-source-point" data-cs-source-point-id="difjn9sufpoj" data-cs-source-point-number="4"></span>
              <span class="hljs-attribute">location</span>=<span class="hljs-value">"templates-soy/kitchen-duty-planning.soy"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">resource</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"download"</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"kitchen-duty-plugin--planning-page-controller.js"</span>
              <span class="hljs-attribute">location</span>=<span class="hljs-value">"/js/kitchen-duty-plugin--planning-page-controller.js"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">context</span>&gt;</span>kitchen-duty-plugin<span class="hljs-tag">&lt;/<span class="hljs-title">context</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">web-resource</span>&gt;</span>
...
<span class="hljs-tag">&lt;/<span class="hljs-title">atlassian-plugin</span>&gt;</span></code></pre>

            </div>
            <div class="col-md-4 cs-sticky-in-parent">
                <div class="list-group cs-source-point-list" data-source-target="difjn9sufpoj">
                    <div class="list-group-item cs-source-point-list__item">
                        We specify teh dependency to AUI Select 2 widget so that JIRA provides it when our bundle is loaded.
                    </div>
                    <div class="list-group-item cs-source-point-list__item">
                        We also specify the special soy dependency as it is stated in the docs (even though I think this does nothing)
                    </div>
                    <div class="list-group-item cs-source-point-list__item">
                        Now we specify a transformer which transforms the soy templates into JavaScript. It transforms all files
                        with <code>soy</code> extension to JavaScript. (But not really all, see next point)
                    </div>
                    <div class="list-group-item cs-source-point-list__item">
                        We specify another download resource. This is the JavaScript file which contains all our soy templates for the planning page.
                        <code>location</code> is the path to the source file which is a soy file. The soy file will be dynamically transformed to JavaScript by
                        the previously defined transformer.
                    </div>
                </div>
            </div>
        </div>
        <p>Now restart <code>atlas-run</code> and refresh (shift-reload) the Page and you should see this:</p>

        
    
    
    <div class="row">
        <div class="offset-md-1 col-md-10">
            <p>
                <a href="/kitchen-duty-plugin-for-atlassian-jira/images/doc/step-03-user-search-select2.gif">
                    <img src="/kitchen-duty-plugin-for-atlassian-jira/images/doc/step-03-user-search-select2.gif" class="img-fluid" alt="Step 3 - User Search working with AUI select2 widget and soy Template"
                         data-bilderrahmen="gallery-01"
                         data-bilderrahmen-title="Step 3 - User Search working with AUI select2 widget and soy Template"
                    >
                </a>
            </p>
        </div>
    </div>


        <div class="cs-v-spacer cs-v-spacer--big"></div>


        <p>Ok we can search for users now and add or remove them to or from our input field.
            In the next chapter we tend to the actual Kitchen Duty Planning REST Resources that save our selection.
            Further chapters will tend to the JS Controller saving the selection and loading the AUI Select 2 with our saved selection.</p>

        <div class="cs-v-spacer cs-v-spacer--big"></div>


        <div class="cs-v-spacer cs-v-spacer--big"></div>
        <div class="cs-v-spacer cs-v-spacer--big"></div>






        <div class="cs-v-spacer"></div>
        <div class="cs-tutorial-step-review">
            <div class="cs-tutorial-step-review__headline">
                <strong>You have completed Step 3.</strong> Good Job! You can check out this step's solution on GitHub
            </div>
            <div class="cs-tutorial-step-review__link">
                <a href="https://github.com/codeclou/kitchen-duty-plugin-for-atlassian-jira/tree/master/step-03-kitchen-duty-plugin">
                    https://github.com/codeclou/kitchen-duty-plugin-for-atlassian-jira/tree/master/step-03-kitchen-duty-plugin
                </a>
            </div>
        </div>

        <div class="cs-v-spacer"></div>
        <p>The graphic shows marked green <strong>which components we implemented in this section</strong>.</p>
        <script>
            var dummyClickCallback = function() {
                toastr.warning('dummy callback', 'Awesome!')
            };
        </script>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-10 offset-lg-1 col-xl-8 offset-xl-2">
                
<svg class="cs-interactive-graphic"
     id="p06-ig01"
     data-json-settings="{
                    &quot;markedAsDone&quot;: [ &quot;webwork-action&quot;, &quot;html-view&quot;, &quot;user-resource&quot;, &quot;user-search-resource-model&quot;, &quot;user-js-controller&quot; ],
                    &quot;markedAsTodo&quot;: [ ],
                    &quot;markedAsGrayedOut&quot;: [ ],
                    &quot;onClick&quot;: [ { &quot;webwork-action&quot;: &quot;dummyClickCallback&quot; } ]
                }"
     data-svg-to-load="kitchen-duty-planning-page--component-overview"
     viewBox="0 0 1043 654"
     preserveAspectRatio="xMaxYMax">
</svg>

            </div>
        </div>

        <div class="cs-v-spacer cs-v-spacer--big"></div>
        <div class="cs-v-spacer cs-v-spacer--big"></div>

    </div>
</div>



        </div>
    </div>
</div>


<div class="cs-footer">
    <div class="cs-legal-box">
        <a href="/kitchen-duty-plugin-for-atlassian-jira/author-and-license/">Author &middot; License &middot; Trademarks</a>
        <a target="_blank" href="https://codeclou.io/legal/impressum-en/">Impressum &middot; Imprint</a>
        <a target="_blank" href="https://codeclou.io/legal/datenschutz-en/">Datenschutz &middot; Privacy</a>
        <a class="d-none d-sm-inline btn-borderless cs-stars-on-github-give-star-button" href="https://github.com/codeclou/kitchen-duty-plugin-for-atlassian-jira" target="_blank">
            star on GitHub
        </a>
    </div>

    <div class="text-right cs-pager">
        <a class="btn btn-secondary" href="/kitchen-duty-plugin-for-atlassian-jira/tutorial/05-step-02-planning-page--user-search-rest-resource/">
            <i class="fa fa-angle-left"></i>
            <span class="d-none d-lg-inline">previous page</span>
        </a>
        
        <a class="btn btn-secondary" href="/kitchen-duty-plugin-for-atlassian-jira/tutorial/07-step-04-planning-page--kitchen-duty-planning-rest-resource/">
            <span class="d-none d-lg-inline">next page</span>
            <i class="fa fa-angle-right"></i></a>
        
    </div>
</div>







<script src="/kitchen-duty-plugin-for-atlassian-jira/generated/bundle.js?v2018-09-02--12-50" async></script>



</body>
</html>
